openapi: 3.0.0
info:
  version: 1.0.0
  title: 受講管理アプリ API
servers:
  - url: 'http://localhost:8080/api'
paths:
  /v1/user:
    get:
      tags:
        - Login-User
      operationId: getLoginUser
      summary: "認証者情報を取得する"
      responses:
        '200':
          description: 認証者情報
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  given_name_by_instructor:
                    $ref: '#/schemas/student/GivenNameNyInstructor'
                  nick_name:
                    $ref: '#/schemas/student/NickName'
                  last_name:
                    $ref: '#/schemas/student/LastName'
                  first_name:
                    $ref: '#/schemas/student/FirstName'
                  occupation:
                    $ref: '#/schemas/student/Occupation'
                  email:
                    $ref: '#/schemas/student/Email'
                  purpose:
                    $ref: '#/schemas/student/Purpose'
                  birth_date:
                    $ref: '#/schemas/student/BirthDate'
                  sex:
                    $ref: '#/schemas/student/Sex'
                  address:
                    $ref: '#/schemas/student/Address'

  /v1/student/:
    patch:
      tags:
        - Student
      operationId: patchStudent
      summary: "生徒情報を更新する。"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nick_name:
                  $ref: '#/schemas/student/NickName'
                last_name:
                  $ref: '#/schemas/student/LastName'
                first_name:
                  $ref: '#/schemas/student/FirstName'
                occupation:
                  $ref: '#/schemas/student/Occupation'
                purpose:
                  $ref: '#/schemas/student/Purpose'
                email:
                  $ref: '#/schemas/student/Email'
                birth_date:
                  $ref: '#/schemas/student/BirthDate'
                sex:
                  $ref: '#/schemas/student/Sex'
                address:
                  $ref: '#/schemas/student/Address'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      nick_name:
                        type: string
                        example: "ニックネーム"
                      last_name:
                        type: string
                        example: "田中"
                      first_name:
                        type: string
                        example: "太郎"
                      occupation:
                        type: string
                        example: "SE"
                      purpose:
                        type: string
                        example: "スキル向上のため"
                      email:
                        type: string
                        example: "test_student_1@example.com"
                      birth_date:
                        type: string
                        format: date-time
                        example: "2022-10-17"
                      sex:
                        type: string
                        example: "woman"
                      address:
                        type: string
                        example: "東京都"
  /v1/student/edit:
    get:
      tags:
        - Student
      operationId: getStudent
      summary: "生徒情報を取得する。"
      responses:
        '200':
          description: 生徒情報
          content:
            application/json:
              schema:
                type: object
                properties:
                  data: 
                    type: object
                    properties:
                      student_id:
                        $ref: '#/schemas/student/StudentId'
                      nick_name:
                        $ref: '#/schemas/student/NickName'
                      last_name:
                        $ref: '#/schemas/student/LastName'
                      first_name:
                        $ref: '#/schemas/student/FirstName'
                      occupation:
                        $ref: '#/schemas/student/Occupation'
                      purpose:
                        $ref: '#/schemas/student/Purpose'
                      email:
                        $ref: '#/schemas/student/Email'
                      birth_date:
                        $ref: '#/schemas/student/BirthDate'
                      sex:
                        $ref: '#/schemas/student/Sex'
                      address:
                        $ref: '#/schemas/student/Address'

  /v1/course/index:
    get:
      tags:
        - Student-Course
      operationId: getCourseIndex
      summary: "受講講座情報の一覧を取得する。"
      parameters:
        - name: student_id
          in: query
          description: 受講者テーブル主キー
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 受講講座一覧
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        course_id:
                          type: integer
                          example: 1
                        title:
                          $ref: '#/schemas/course/Title'
                        image:
                          $ref: '#/schemas/course/Image'
                        instructor:
                          type: object
                          properties:
                            instructor_id:
                              $ref: '#/schemas/instructor/InstructorId'
                            nick_name:
                              $ref: '#/schemas/instructor/NickName'
                            last_name:
                              $ref: '#/schemas/instructor/LastName'
                            first_name:
                              $ref: '#/schemas/instructor/FirstName'
                            email:
                              $ref: '#/schemas/instructor/Email'
                        attendance:
                          type: object
                          properties:
                            attendance_id:
                              $ref: '#/schemas/attendance/AttendanceId'
                            progress:
                              $ref: '#/schemas/attendance/Progress'
  /v1/course:
    get:
      tags:
        - Student-Course
      operationId: getCourse
      summary: "受講講座の詳細情報を取得する。"
      parameters:
        - name: attendance_id
          in: query
          description: 受講テーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: 講座詳細情報
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      course_id:
                        type: integer
                        example: 1
                      title:
                        $ref: '#/schemas/course/Title'
                      image:
                        $ref: '#/schemas/course/Image'
                      instructor:
                        type: object
                        properties:
                          instructor_id:
                            $ref: '#/schemas/instructor/InstructorId'
                          nick_name:
                            $ref: '#/schemas/instructor/NickName'
                          last_name:
                            $ref: '#/schemas/instructor/LastName'
                          first_name:
                            $ref: '#/schemas/instructor/FirstName'
                          email:
                            $ref: '#/schemas/instructor/Email'
                      attendance:
                        type: object
                        properties:
                          attendance_id:
                            $ref: '#/schemas/attendance/AttendanceId'
                          progress:
                            $ref: '#/schemas/attendance/Progress'
                      chapters:
                        type: array
                        items:
                          type: object
                          properties:
                            chapter_id:
                              $ref: '#/schemas/chapter/ChapterId'
                            title:
                              $ref: '#/schemas/chapter/Title'
                            lessons:
                              type: array
                              items:
                                type: object
                                properties:
                                  lesson_id:
                                    $ref: '#/schemas/lesson/LessonId'
                                  title:
                                    $ref: '#/schemas/lesson/Title'
                                  url:
                                    $ref: '#/schemas/lesson/Url'
                                  remarks:
                                    $ref: '#/schemas/lesson/Remarks'
                                  lesson_attendance:
                                    type: object
                                    properties:
                                      lesson_attendance_id:
                                        $ref: '#/schemas/lesson-attendance/LessonAttendanceId'
                                      status:
                                        $ref: '#/schemas/lesson-attendance/Status'
  /v1/course/{course_id}/progress:
    get:
      tags:
        - Student-Course
      operationId: getCourseProgress
      summary: "受講講座の進捗率を取得する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: 講座進捗率
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      course:
                        type: object
                        properties:
                          course_id:
                            $ref: '#/schemas/course/CourseId'
                          progress:
                            type: integer
                            example: 10
                      number_of_completed_chapters:
                        type: integer
                        example: 1
                      number_of_total_chapters:
                        type: integer
                        example: 3
                      number_of_completed_lessons:
                        type: integer
                        example: 2
                      number_of_total_lessons:
                        type: integer
                        example: 6
                      continue_lesson_id:
                        type: integer
                        example: 3
                      youngestUnCompletedLessonId:
                        type: integer
                        example: 4

  /v1/course/chapter:
    get:
      tags:
        - Student-Chapter
      operationId: getChapter
      summary: "受講講座のチャプターの詳細情報を取得する。"
      parameters:
        - name: chapter_id
          in: query
          description: チャプターテーブルの主キー
          required: true
          type: integer
        - name: attendance_id
          in: query
          description: 受講テーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: チャプター詳細情報
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      chapter_id:
                        $ref: '#/schemas/chapter/ChapterId'
                      title:
                        $ref: '#/schemas/chapter/Title'
                      lessons:
                        type: array
                        items:
                          type: object
                          properties:
                            lesson_id:
                              $ref: '#/schemas/lesson/LessonId'
                            title:
                              $ref: '#/schemas/lesson/Title'
                            url:
                              $ref: '#/schemas/lesson/Url'
                            remarks:
                              $ref: '#/schemas/lesson/Remarks'
                            lesson_attendance:
                              type: object
                              properties:
                                lesson_attendance_id:
                                  $ref: '#/schemas/lesson-attendance/LessonAttendanceId'
                                status:
                                  $ref: '#/schemas/lesson-attendance/Status'
  
  /v1/lesson-attendance:
    patch:
      tags:
        - Lesson-Attendance
      operationId: patchLessonAttendance
      summary: "レッスン受講状態更新"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - "lesson_attendance_id"
                - "status"
              type: "object"
              properties:
                lesson_attendance_id:
                  type: "int"
                  description: レッスン受講状態ID
                  example: 1
                status:
                  type: "string"
                  description: 状態(受講前、受講中、受講完了)
                  example: 'in_attendance'
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
  /v1/instructor/course/index:
    get:
      tags:
        - Instructor-Course
      operationId: getInstructorCourseIndex
      summary: "講師講座一覧参照"
      responses:
        '200':
          description: 講座一覧
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        course_id:
                          $ref: '#/schemas/course/CourseId'
                        title:
                          $ref: '#/schemas/course/Title'
                        image:
                          $ref: '#/schemas/course/Image'
                        status:
                          $ref: '#/schemas/course/Status'
  /v1/instructor/course/{course_id}:
    get:
      tags:
        - Instructor-Course
      operationId: getInstructorCourse
      summary: "講座の詳細情報を取得する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: 講座詳細情報
          content:
            application/json:
              schema:
                type: object
                properties:
                  data: 
                    type: object
                    properties:
                      course_id:
                        $ref: '#/schemas/course/CourseId'
                      title:
                        $ref: '#/schemas/course/Title'
                      image:
                        $ref: '#/schemas/course/Image'
                      status:
                        $ref: '#/schemas/course/Status'
                      chapters:
                        type: array
                        items:
                          type: object
                          properties:
                            chapter_id:
                              $ref: '#/schemas/chapter/ChapterId'
                            title:
                              $ref: '#/schemas/chapter/Title'
                            order:
                              $ref: '#/schemas/chapter/Order'
                            lessons:
                              type: array
                              items:
                                type: object
                                properties:
                                  lesson_id:
                                    $ref: '#/schemas/lesson/LessonId'
                                  title:
                                    $ref: '#/schemas/lesson/Title'
                                  url:
                                    $ref: '#/schemas/lesson/Url'
                                  remarks:
                                    $ref: '#/schemas/lesson/Remarks'
    post:
      tags:
        - Instructor-Course
      operationId: patchInstructorCourse
      summary: "講座情報を更新する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: "object"
              properties:
                title:
                  type: "string"
                  description: タイトル
                  example: '講座タイトル'
                image:
                  type: "file"
                  description: 画像ファイル
                  example: 'thumbnail.png'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
                  data: 
                    type: object
                    properties:
                      course_id:
                        $ref: '#/schemas/course/CourseId'
                      title:
                        $ref: '#/schemas/course/Title'
                      image:
                        $ref: '#/schemas/course/Image'
                      status:
                        $ref: '#/schemas/course/Status'
    delete:
      tags:
        - Instructor-Course
      operationId: deleteInstructorCourse
      summary: "講座情報を削除する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
  /v1/instructor/course/{course_id}/edit:
    get:
      tags:
        - Instructor-Course
      operationId: getInstructorCourseEdit
      summary: "編集講座の情報を取得する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: 講座詳細情報
          content:
            application/json:
              schema:
                type: object
                properties:
                  data: 
                    type: object
                    properties:
                      course_id:
                        $ref: '#/schemas/course/CourseId'
                      title:
                        $ref: '#/schemas/course/Title'
                      image:
                        $ref: '#/schemas/course/Image'
                      status:
                        $ref: '#/schemas/course/Status'
  /v1/instructor/course:
    post:
      tags:
        - Instructor-Course
      operationId: postInstructorCourse
      summary: "講座情報を登録する。"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: "object"
              properties:
                title:
                  type: "string"
                  description: タイトル
                  example: '講座タイトル'
                image:
                  type: "file"
                  description: 画像ファイル
                  example: 'thumbnail.png'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
  /v1/instructor/course/{course_id}/chapter:
    post:
      tags:
        - Instructor-Chapter
      operationId: postInstructorChapter
      summary: "チャプター情報を登録する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                title:
                  $ref: '#/schemas/chapter/Title'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
  /v1/instructor/course/{course_id}/chapter/{chapter_id}:
    get:
      tags:
        - Instructor-Chapter
      operationId: getInstructorChapter
      summary: "チャプターの詳細情報を取得する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
        - name: chapter_id
          in: path
          description: チャプターテーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: チャプター詳細情報
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      chapter_id:
                        $ref: '#/schemas/chapter/ChapterId'
                      title:
                        $ref: '#/schemas/chapter/Title'
                      lessons:
                        type: array
                        items:
                          type: object
                          properties:
                            lesson_id:
                              $ref: '#/schemas/lesson/LessonId'
                            title:
                              $ref: '#/schemas/lesson/Title'
                            url:
                              $ref: '#/schemas/lesson/Url'
                            remarks:
                              $ref: '#/schemas/lesson/Remarks'
                            order:
                              $ref: '#/schemas/lesson/Order'
    patch:
      tags:
        - Instructor-Chapter
      operationId: patchInstructorChapter
      summary: "チャプター情報を更新する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
        - name: chapter_id
          in: path
          description: チャプターテーブルの主キー
          required: true
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                title:
                  type: "string"
                  description: タイトル
                  example: 'チャプタータイトル'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
    delete:
      tags:
        - Instructor-Chapter
      operationId: deleteInstructorChapter
      summary: "チャプター情報を削除する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
        - name: chapter_id
          in: path
          description: チャプターテーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
  /v1/instructor/course/{course_id}/chapter/sort:
    post:
      tags:
        - Instructor-Chapter
      operationId: sortInstructorChapter
      summary: "チャプター情報の並び順を更新する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                chapters:
                  type: "array"
                  description: チャプターの配列
                  items:
                    type: "object"
                    properties:
                      chapter_id:
                        $ref: '#/schemas/chapter/ChapterId'
                      order:
                        $ref: '#/schemas/chapter/Order'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true

  /v1/instructor/course/{course_id}/chapter/{chapter_id}/lesson:
    post:
      tags:
        - Instructor-Lesson
      operationId: storeInstructorChapterLesson
      summary: "レッスン情報を登録する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
        - name: chapter_id
          in: path
          description: チャプターテーブルの主キー
          required: true
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                title:
                  type: "string"
                  description: タイトル
                  example: 'swaggerの書き方'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
                  data:
                    type: "object"
                    properties:
                      lesson_id:
                        $ref: '#/schemas/lesson/LessonId'
                      title:
                        $ref: '#/schemas/lesson/Title'
                      status:
                        $ref: '#/schemas/lesson/Status'
                      order:
                        $ref: '#/schemas/lesson/Order'
  /v1/instructor/course/{course_id}/chapter/{chapter_id}/lesson/{lesson_id}}:
    patch:
      tags:
        - Instructor-Lesson
      operationId: patchInstructorChapterLesson
      summary: "レッスン情報を更新する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
        - name: chapter_id
          in: path
          description: チャプターテーブルの主キー
          required: true
          type: integer
        - name: lesson_id
          in: path
          description: レッスンテーブルの主キー
          required: true
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                title:
                  type: "string"
                  description: タイトル
                  example: 'レッスンタイトル'
                url:
                  type: "string"
                  description: URL
                  example: 'https://www.youtube.com/watch?v=xxxxxxxxxxx'
                remarks:
                  type: "string"
                  description: 備考
                  example: '備考'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
    delete:
      tags:
        - Instructor-Lesson
      operationId: deleteInstructorChapterLesson
      summary: "レッスン情報を削除する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer
        - name: chapter_id
          in: path
          description: チャプターテーブルの主キー
          required: true
          type: integer
        - name: lesson_id
          in: path
          description: レッスンテーブルの主キー
          required: true
          type: integer
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                required:
                  - "result"
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
  /v1/instructor/course/{course_id}/chapter/{chapter_id}/lesson/sort:
    post:
      tags: 
        - Instructor-Lesson
      operationId: sortInstructorChapterLesson
      summary: "レッスン情報の並び順を更新する。"
      parameters:
        - name: course_id
          in: path
          description: 講座テーブルの主キー
          required: true
          type: integer 
        - name: chapter_id
          in: path
          description: チャプターテーブルの主キー
          required: true
          type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: "object"
              properties:
                lessons:
                  type: "array"
                  description: レッスンの配列
                  items:
                    type: "object"
                    properties:
                      lesson_id:
                        $ref: '#/schemas/lesson/LessonId'
                      order:
                        $ref: '#/schemas/lesson/Order'
      responses:
        '200':
          description: "Success"
          content:
            application/json:
              schema:
                type: "object"
                properties:
                  result:
                    type: "boolean"
                    example: true
schemas:
  student:
    StudentId:
      type: integer
      description: 生徒テーブル主キー
      example: 1
    GivenNameNyInstructor:
      type: string
      description: ユーザー名
      example: "ユーザー名"
    NickName:
      type: string
      description: ニックネーム
      example: "ニックネーム"
    LastName:
      type: string
      description: 名字
      example: "名字"
    FirstName:
      type: string
      description: 名前
      example: "名前"
    Occupation:
      type: string
      description: 職業
      example: "エンジニア"
    Email:
      type: string
      description: メールアドレス
      example: "test@example.com"
    Purpose:
      type: string
      description: 目的
      example: "スキルアップのため"
    BirthDate:
      type: string
      description: 生年月日
      example: "2022-10-17"
    Sex:
      type: string
      description: 性別
      example: "woman"
    Address:
      type: string
      description: 住所
      example: "東京都"
  instructor:
    InstructorId:
      type: integer
      description: 講師テーブル主キー
      example: 1
    NickName:
      type: string
      description: ニックネーム
      example: "ニックネーム"
    LastName:
      type: string
      description: 名字
      example: "名字"
    FirstName:
      type: string
      description: 名前
      example: "名前"
    Email:
      type: string
      description: メールアドレス
      example: "test@example.com"
  course:
    CourseId:
      type: integer
      description: 講座テーブル主キー
      example: 1
    Title:
      type: "string"
      description: "講座名"
      example: "PHP入門講座"
    Image:
      type: "string"
      description: "講座サムネイル画像ファイルパス"
      example: "/course/xxx.png"
    Status:
      type: "string"
      description: "講座ステータス"
      example: "public"
  attendance:
    AttendanceId:
      type: integer
      description: 受講テーブル主キー
      example: 1
    Progress:
      type: "integer"
      description: "進捗率"
      example: 70
  chapter:
    ChapterId:
      type: integer
      description: チャプターテーブルの主キー
      example: 1
    Title:
      type: string
      description: チャプタータイトル
      example: "Hello Worldを出力する"
    Order:
      type: integer
      description: 順番
      example: 1
  lesson:
    LessonId:
      type: integer
      description: レッスンテーブルの主キー
      example: 1
    Title:
      type: string
      description: レッスン名
      example: "swaggerの書き方"
    Url:
      type: string
      description: 教材動画URL
      example: "http::www.youtube"
    Remarks:
      type: string
      description: 備考欄
      example: "動画index"
    Order:
      type: integer
      description: 順番
      example: 1
  lesson-attendance:
    LessonAttendanceId:
      type: integer
      description: レッスン受講テーブルの主キー
      example: 1
    Status:
      type: string
      description: レッスン受講状態（未着手, 着手, 完了）
      example: "before_attendance"